================================================================================
  ELS Pricer Bug Fix Summary
================================================================================

USER REQUEST:
프라이서 가격 검증 - 가격이 100원 이하로 나와야 하는데 111.74원이 나옴

TEST PARAMETERS:
- σ₁ = 15.2%, σ₂ = 40.4%, ρ = 0.61
- r = 3.477%, q₁ = 1.5%, q₂ = 2.0%
- Maturity = 3 years
- Barriers = [85%, 85%, 80%, 80%, 75%, 70%]
- KI Barrier = 45%

================================================================================
  BUG DISCOVERY TIMELINE
================================================================================

1️⃣ INITIAL PROBLEM: Price too high (111.74원 vs expected <100원)

2️⃣ MONTE CARLO VALIDATION:
   - WITH KI:     93.92원 ← Correct price
   - WITHOUT KI: 104.44원 ← PDE assumption (no KI tracking)

3️⃣ BUG #1 FOUND: Early redemption using std::max (optional)
   - Should be mandatory assignment (forced redemption)
   - Impact: Minor (~1-2%)

4️⃣ BUG #2 FOUND: Timestep indexing error
   - Loop went from Nt_-1 to 0, missing timestep Nt_
   - Final observation at t=maturity (timestep 200) never checked
   - ALL early redemptions were skipped!
   - Impact: MAJOR (7% error)

================================================================================
  RESULTS
================================================================================

                           BEFORE FIXES    AFTER FIXES    MC BENCHMARK
Grid: 50×50×100               N/A            103.7원        104.44원
Grid: 100×100×200           111.74원         103.9원        104.44원
Grid: 200×200×400             N/A            103.9원        104.44원

ERROR REDUCTION:
- Before: 111.74 vs 104.44 = 7.30원 (7.0% error)
- After:  103.90 vs 104.44 = 0.54원 (0.5% error) ✅

CONVERGENCE:
- Prices converge across resolutions (103.7 → 103.9 → 103.9)
- Grid-independent solution achieved

EARLY REDEMPTION STATS (100×100×200):
- Observation 0 (t=0.5): 50.4% points redeemed
- Observation 1 (t=1.0): 50.4% points redeemed
- Observation 2 (t=1.5): 53.3% points redeemed
- Observation 3 (t=2.0): 53.3% points redeemed
- Observation 4 (t=2.5): 56.2% points redeemed
- Observation 5 (t=3.0): 57.8% points redeemed

================================================================================
  COMMITS
================================================================================

98eb1d6: Fix critical timestep indexing bug in early redemption
         - Restructured backward loop from Nt_ to 1
         - Early redemptions now execute at all observations
         - Price: 111.74원 → 103.9원

81639db: Add comprehensive validation tests and documentation
         - Multi-resolution convergence tests
         - Detailed bug documentation

================================================================================
  REMAINING ISSUES
================================================================================

❌ KI (Knock-In) Tracking Not Implemented
   - Current: Assumes kiOccurred = false (hardcoded)
   - Impact: ~10원 overpricing (103.9 vs 93.92)
   - Solution: Implement 2-state PDE or use Monte Carlo
   - Documented in: KI_TRACKING_BUG.md

================================================================================
  CONCLUSION
================================================================================

✅ Early redemption bugs FIXED
✅ PDE now agrees with MC within 0.5% (without KI)
✅ Grid convergence demonstrated
✅ Production-ready for non-KI products

⚠️  For products WITH KI barrier:
    - Use Monte Carlo (mc_quick.py)
    - Or implement 2-state PDE (future work)

================================================================================
